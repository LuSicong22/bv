东家BV共赢计划

1.  需求概述

> 东家亚太版的东家打赏页面,搞一个BV共赢计划的入口,点进去先看一下相关功能介绍HTML,然后进入对应的主页面
>
> 主页面有3个角色,分别是担保人,团队长,新东家,他们3个角色形成关联实现相应功能

2.  涉及到的表

\--担保人信息表

select \* from TZC_DBR;

![](media/image1.png){width="5.768055555555556in"
height="2.140972222222222in"}

\--东家邀请码表,新增担保人和担保人状态以及担保数量

select \* from TZC_USER_DJ where typeid = 0;

![](media/image2.png){width="5.768055555555556in"
height="1.6993055555555556in"}

\--东家信息表(缓存表),新增担保人和担保人状态以及担保数量,通过触发器修改

select \* from tzc_djbv where nodeid in(4264867, 2989);

![](media/image3.png){width="5.768055555555556in"
height="2.2618055555555556in"}

\--代打赏历史

> select \* from TZC_BVWIN_HIS;
>
> ![](media/image4.png){width="5.768055555555556in" height="2.24375in"}

3.  具体实现

<!-- -->

1)  关于担保人角色

<!-- -->

a.  只有当前的东家4,5,6星才有资格申请成为担保人,如果用户东家星级大于等于4星时,可以申请成为担保人

b.  申请担保人页面,显示当前用户绑定的码库账号,以及码库账号当前剩余的STC,输入STC数量,计算担保金额(当前1STC=2CNV),即例如输入10万,则担保金额就是20万,在config中配置一个最小值,比如5万STC,即10万CNV,输入的值不能低于该值

c.  申请后,冻结码库账号对应的STC,并在PK库记录一条担保人信息的数据

d.  成为担保人后,可以在担保人后台可以看到我的所有团队长列表,点击一个团队长可以看到他的所有下属新东家,团队长的账号,脱敏的姓名,脱敏的手机号码,新东家的账号,新东家脱敏后的姓名,脱敏后的手机号码,当前尚未处理完的金额

e.  可以看到所有新东家申请的代打赏记录以及状态,方便他监控和通知团队长

<!-- -->

2)  关于团队长

<!-- -->

a.  暂定为3星或以上星级用户可以申请成为团队长,输入一个担保人账号,显示担保人的常规信息,比如头像,账号,脱敏后的姓名,脱敏后的手机号码,当前剩余的担保额度,点击确认后记录数据,状态为待担保人审核,注意:担保人不能是用户自己

b.  担保人在后台可以看到所有申请中以及审核通过的团队长列表,申请中的列表,可以审核通过和审核拒绝

c.  如果审核通过则用户就是团队长了,如果审核拒绝,用户还可以继续申请其他担保人

d.  团队长可以在他的后台看到他下面的所有新东家列表,以及可以看到所有新东家申请的代打赏记录信息

<!-- -->

3)  关于新东家

<!-- -->

a.  任何用户都进入新东家页面,可以看到他当前的团队长以及团队长的担保人信息,团队长的账号,脱敏后的姓名,脱敏后的手机号码,担保人的账号,担保人脱敏后的姓名,担保人脱敏后的手机号码,
    剩余可代打赏团队长的数量显示

b.  在新东家页面,如果他没有团队长,或者有但是不是团队长时,可以重新填写一个团队长的邀请码进行绑定

c.  在新东家页面当他有团队长后,有一个"申请代打赏"的功能入口,进去后显示当前用户的码库账号,当前可用CNV余额,当前可用DOS余额,输入CNV数量,自动显示需要DOS数量为CNV的1%,余额要充足方可提交

d.  提交后,码库冻结他的CNV和DOS,并在P客产生一条订单数据,再给他的团队长发送1条短信

e.  团队长在团队长的页面上可以看到对应的代打赏信息,信息要明确有新东家账号,手机号码,CNV数量之类的信息,确保他看到这些信息后就能给他代打赏

f.  团队长通过自己或其他账号给他代打赏后,在对应代打赏记录这里有一个已代打赏的按钮,点击后,输入代打赏的订单号,并确定

g.  确定后,我们程序检查,对应订单是否为代打赏订单,被代打赏用户是否为申请的新东家,代打赏时间是否大于申请时间,如果不符合要求则提示,如果符合要求则处理后续业务.1.调用码库接口.将1%DOS扣给系统,将CNV的10%部分,扣给团队长的上级担保人的CNV,将剩下90%CNV部分的30%,转给团队长的STC钱包,并冻结起来,将90%CNV部分的70%转给团队长的CNV钱包,2.P客这边修改订单状态,3.短信通知新东家,4.扣减相应额度的担保人的可担保数量

h.  在新东家页面有一个当前剩余可代打赏团队长的数量显示,以及"代打赏团队长"的入口,点击后直接进入代打赏团队长页面,使用BV+东家积分代打赏团队长,并记录历史,从新东家页面进入的本次代打赏团队长时,需要判断必须小于等于剩余可代打赏数量,提交后

i.  正常生成代打赏订单,并产生一笔记录,然后调用码库接口通知码库从团队长的码库账号扣款CNV
    到新东家自己的CNV账号,不管是否够扣,都需要返回给P客做后续处理,如果够扣且已扣,则P客这边修改订单状态为成功,并增加他对应的担保人担保额度

<!-- -->

4)  

<!-- -->

4.  参考样式

> ![](media/image5.png){width="5.768055555555556in" height="3.11875in"}
>
> ![](media/image6.png){width="5.768055555555556in"
> height="3.209722222222222in"}
>
> ![](media/image7.png){width="5.768055555555556in"
> height="3.2777777777777777in"}
>
> ![](media/image8.png){width="5.768055555555556in"
> height="3.022222222222222in"}

5.  其他说明

> ![](media/image9.emf)
