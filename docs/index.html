<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>页面全局预览</title>
    <style>
      :root {
        color-scheme: light;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "SF Pro Display", "PingFang SC", system-ui, -apple-system,
          sans-serif;
        background: #1e1e1e;
        color: #e5e7eb;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        display: flex;
        padding: 16px 20px;
        justify-content: space-between;
        gap: 12px;
        align-items: center;
        background: rgba(15, 23, 42, 0.96);
        backdrop-filter: blur(16px);
        border-bottom: 1px solid #111827;
        position: sticky;
        top: 0;
        z-index: 2;
      }

      .title-block {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .title-mark {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        background: linear-gradient(135deg, #f97316, #f97316);
        display: grid;
        place-items: center;
        font-weight: 700;
        color: #ffffff;
        letter-spacing: 0.5px;
      }

      .subtitle {
        margin: 2px 0 0;
        color: #9ca3af;
        font-size: 13px;
      }

      .controls {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #9ca3af;
        font-size: 14px;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .range {
        width: 140px;
        accent-color: #f97316;
      }

      .badge {
        padding: 6px 10px;
        border-radius: 999px;
        background: #111827;
        color: #e5e7eb;
        font-weight: 600;
        font-size: 13px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      main {
        flex: 1;
        position: relative;
        overflow: hidden;
      }

      .workspace {
        position: absolute;
        inset: 0;
        cursor: grab;
        background-color: #1e1e1e;
        background-image: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.06) 0, transparent 55%),
          radial-gradient(circle at 100% 100%, rgba(148, 163, 184, 0.35) 0, transparent 60%);
      }

      .workspace.panning {
        cursor: grabbing;
      }

      .board {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: 0 0;
        display: flex;
        flex-direction: column;
        gap: 40px;
      }

      .identity-row {
        display: flex;
        align-items: flex-start;
        gap: 24px;
      }

      .identity-label {
        min-width: 160px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding-top: 6px;
        color: #d1d5db;
        font-size: 13px;
      }

      .identity-label-main {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
      }

      .identity-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
      }

      .identity-label-sub {
        font-size: 12px;
        color: #9ca3af;
      }

      .identity-pages {
        display: flex;
        flex-wrap: nowrap;
        align-items: flex-start;
        gap: 24px;
      }

      .page-item {
        display: flex;
        flex-direction: column;
        gap: 6px;
        cursor: pointer;
      }

      .page-label {
        font-size: 12px;
        color: #9ca3af;
      }

      .page-label strong {
        color: #e5e7eb;
      }

      .preview-shell {
        position: relative;
        border-radius: 12px;
        border: 1px solid #111827;
        overflow: hidden;
        background: #020617;
      }

      .preview-frame {
        width: 100%;
        height: 100%;
        border: none;
        transform-origin: top left;
        background: white;
      }

      .footer-tip {
        position: absolute;
        right: 16px;
        bottom: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        font-size: 13px;
        border-radius: 10px;
        backdrop-filter: blur(12px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      }

      .footer-tip strong {
        color: #fff7ed;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title-block">
        <div class="title-mark">BV</div>
        <div>
          <h1 style="margin: 0; font-size: 20px;">全局原型预览</h1>
          <p class="subtitle">滚轮上下滚动视图，按住 Command + 滚轮缩放；按住鼠标右键拖拽平移，点击任意缩略图跳转到对应页面</p>
        </div>
      </div>
      <div class="controls">
        <span class="badge" id="page-count">0 个页面</span>
        <div class="control-group">
          <label for="zoom">缩放</label>
          <input id="zoom" class="range" type="range" min="25" max="180" value="85" />
          <span id="zoom-value">85%</span>
        </div>
      </div>
    </header>
    <main>
      <div class="workspace" id="workspace">
        <div class="board" id="board"></div>
        <div class="footer-tip">
          <span>右键拖拽平移视图</span>
          <span>Command/Ctrl + 滚轮缩放</span>
        </div>
      </div>
    </main>

    <script>
      const groups = [
        {
          id: "owner",
          name: "新东家（业主）",
          description: "移动端主流程：身份选择入口、业主主页、申请团队长",
          color: "#f97316",
          pages: [
            { title: "身份选择入口", path: "identity_selection_entry.html", width: 390, height: 880 },
            { title: "业主主页", path: "new_owner.html", width: 390, height: 1045 },
            { title: "申请组长", path: "apply_team_leader.html", width: 390, height: 1000 },
            { title: "申请完成", path: "apply_team_leader_confirmation.html", width: 390, height: 880 }
          ]
        },
        {
          id: "leader",
          name: "团队长视角",
          description: "团队长首页 / 身份首页 / 团队长列表",
          color: "#10b981",
          pages: [
            { title: "组长首页", path: "team_leader_home.html", width: 1280, height: 900 },
            { title: "组长身份首页", path: "team_leader_identity_home.html", width: 1280, height: 900 },
            { title: "组长列表", path: "team_leader_list.html", width: 1280, height: 900 }
          ]
        },
        {
          id: "guarantor",
          name: "担保人视角",
          description: "担保人首页及配额总览",
          color: "#1c6de4",
          pages: [{ title: "担保人首页", path: "guarantor_home.html", width: 1280, height: 900 }]
        },
        {
          id: "misc",
          name: "其它页面",
          description: "首页备份、设计规范与临时方案等",
          color: "#9ca3af",
          pages: [
            { title: "首页备份", path: "index_backup.html", width: 390, height: 844 },
            { title: "设计规范 - 色彩", path: "../product_requirements/bv-color-system.html", width: 1280, height: 720 },
            { title: "设计规范 - 字体", path: "../product_requirements/bv-typography.html", width: 1280, height: 720 },
            { title: "临时方案 temp3", path: "../temp3.html", width: 1280, height: 900 }
          ]
        }
      ];

      const board = document.getElementById("board");
      const workspace = document.getElementById("workspace");
      const zoomRange = document.getElementById("zoom");
      const zoomValue = document.getElementById("zoom-value");
      const pageCount = document.getElementById("page-count");
      const previewScale = 0.35;

      const allPages = groups.flatMap((group) => group.pages);

      let translate = { x: -420, y: -260 };
      let scale = zoomRange.value / 100;
      let isPanning = false;
      let startOffset = { x: 0, y: 0 };

      const clamp = (val, min, max) => Math.min(Math.max(val, min), max);

      function applyTransform() {
        board.style.transform = `translate(${translate.x}px, ${translate.y}px) scale(${scale})`;
        zoomValue.textContent = `${Math.round(scale * 100)}%`;
      }

      function renderPages() {
        pageCount.textContent = `${allPages.length} 个页面`;

        groups.forEach((group) => {
          const row = document.createElement("section");
          row.className = "identity-row";

          const label = document.createElement("div");
          label.className = "identity-label";

          const labelMain = document.createElement("div");
          labelMain.className = "identity-label-main";

          const dot = document.createElement("span");
          dot.className = "identity-dot";
          dot.style.backgroundColor = group.color;

          const name = document.createElement("span");
          name.textContent = group.name;

          labelMain.append(dot, name);

          const labelSub = document.createElement("div");
          labelSub.className = "identity-label-sub";
          labelSub.textContent = group.description;

          label.append(labelMain, labelSub);

          const pagesContainer = document.createElement("div");
          pagesContainer.className = "identity-pages";

          group.pages.forEach((page) => {
            const item = document.createElement("article");
            item.className = "page-item";

            const label = document.createElement("div");
            label.className = "page-label";
            const fileName = page.path.split("/").pop();
            label.innerHTML = `<strong>${page.title}</strong>（${fileName}）`;

            const wrapper = document.createElement("div");
            wrapper.className = "preview-shell";
            wrapper.style.width = `${page.width * previewScale}px`;
            wrapper.style.height = `${page.height * previewScale}px`;

            const iframe = document.createElement("iframe");
            iframe.className = "preview-frame";
            iframe.loading = "lazy";
            iframe.src = page.path;
            iframe.style.width = `${page.width}px`;
            iframe.style.height = `${page.height}px`;
            iframe.style.transform = `scale(${previewScale})`;
            iframe.style.pointerEvents = "none";

            wrapper.appendChild(iframe);
            item.append(label, wrapper);
            item.addEventListener("click", () => {
              window.location.href = page.path;
            });

            pagesContainer.appendChild(item);
          });

          row.append(label, pagesContainer);
          board.appendChild(row);
        });
      }

      renderPages();
      applyTransform();

      zoomRange.addEventListener("input", (e) => {
        scale = e.target.value / 100;
        applyTransform();
      });

      workspace.addEventListener("mousedown", (e) => {
        if (e.button !== 2) return;
        isPanning = true;
        workspace.classList.add("panning");
        startOffset = { x: e.clientX - translate.x, y: e.clientY - translate.y };
      });

      window.addEventListener("mousemove", (e) => {
        if (!isPanning) return;
        translate.x = e.clientX - startOffset.x;
        translate.y = e.clientY - startOffset.y;
        applyTransform();
      });

      window.addEventListener("mouseup", () => {
        isPanning = false;
        workspace.classList.remove("panning");
      });

      workspace.addEventListener("contextmenu", (e) => {
        e.preventDefault();
      });

      workspace.addEventListener(
        "wheel",
        (e) => {
          const isZoom = e.metaKey || e.ctrlKey;
          if (isZoom) {
            e.preventDefault();
            const rect = workspace.getBoundingClientRect();
            const offsetX = e.clientX - rect.left;
            const offsetY = e.clientY - rect.top;
            const delta = clamp(-e.deltaY * 0.0012, -0.4, 0.4);
            const newScale = clamp(scale * (1 + delta), 0.25, 1.8);
            const scaleRatio = newScale / scale;

            translate.x = offsetX - (offsetX - translate.x) * scaleRatio;
            translate.y = offsetY - (offsetY - translate.y) * scaleRatio;

            scale = newScale;
            zoomRange.value = Math.round(scale * 100);
            applyTransform();
          } else {
            e.preventDefault();
            translate.x -= e.deltaX;
            translate.y -= e.deltaY;
            applyTransform();
          }
        },
        { passive: false }
      );
    </script>
  </body>
</html>
