<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>新东家身份 · 首页</title>
    <style>
      :root {
        /* 主题绿 - 主色以 #10B981 为核心 */
        --primary-50: #ecfdf5;
        --primary-100: #d1fae5;
        --primary-200: #a7f3d0;
        --primary-300: #6ee7b7;
        --primary-400: #34d399;
        --primary-500: #10b981; /* 要求的主题色 */
        --primary-600: #059669;
        --primary-700: #047857;
        --primary-800: #065f46;
        --primary-900: #064e3b;

        --neutral-0: #ffffff;
        --neutral-50: #f7f9fb;
        --neutral-100: #eef1f4;
        --neutral-200: #dadfe4;
        --neutral-400: #a1a8ae;
        --neutral-600: #6a737c;
        --neutral-900: #1e252d;

        --success: #10b981;
        --warning: #f6c247;
        --error: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: var(--neutral-0);
        color: var(--neutral-900);
        font-family: "PingFang SC", -apple-system, BlinkMacSystemFont, Segoe UI,
          Roboto, system-ui, sans-serif;
        line-height: 1.55;
      }

      /* Mobile-first 容器（仅移动端使用） */
      .page {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        padding: 16px 12px calc(24px + env(safe-area-inset-bottom));
      }

      /* 顶部区 */
      .hero {
        position: relative;
        border-radius: 18px;
        padding: 20px 18px;
        background: linear-gradient(180deg, var(--primary-50), #fff 60%);
        border: 1px solid var(--neutral-100);
        overflow: hidden;
      }

      /* Hero 网格版（绿色品牌底 + 网格纹理 + 高光） */
      .hero.hero-grid {
        border-radius: 22px;
        color: #fff;
        border: none;
        background: radial-gradient(
            800px 280px at -10% -30%,
            rgba(255, 255, 255, 0.26),
            rgba(255, 255, 255, 0) 60%
          ),
          repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.05) 0 1px,
            transparent 1px 24px
          ),
          repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.05) 0 1px,
            transparent 1px 24px
          ),
          linear-gradient(135deg, var(--primary-500), var(--primary-600));
        box-shadow: 0 12px 40px rgba(16, 185, 129, 0.22);
      }
      .hero.hero-grid .hero-sub {
        color: rgba(255, 255, 255, 0.9);
      }
      .hero.hero-grid .pill {
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.24);
      }
      .hero.hero-grid .pill-dot {
        background: #fff;
      }
      .hero.hero-grid .star-chip {
        background: rgba(255, 255, 255, 0.14);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.22);
      }
      .hero.hero-grid .icon-star {
        fill: #fff;
      }
      .hero.hero-grid .info-btn {
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.24);
      }

      /* Hero 指标区 */
      .hero-metrics {
        margin-top: 14px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .hero-metric {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.22);
        border-radius: 14px;
        padding: 10px 12px;
      }
      .hero-metric .metric-label {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.92);
      }
      .hero-metric .metric-value {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
      }
      .hero-metric .metric-number {
        font-size: 20px;
        font-weight: 800;
        color: #fff;
        line-height: 1;
      }

      /* 右上角 BV 徽章（环状光影） */
      .hero-badge {
        position: absolute;
        top: 14px;
        right: 14px;
        width: 58px;
        height: 58px;
        border-radius: 50%;
        display: block;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='cardG' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23ECFDF5'/%3E%3Cstop offset='1' stop-color='%2310B981'/%3E%3C/linearGradient%3E%3ClinearGradient id='arrowG' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%2334D399'/%3E%3Cstop offset='1' stop-color='%23059669'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='14' y='18' width='36' height='26' rx='6' ry='6' fill='url(%23cardG)' stroke='%230EA5A1' stroke-opacity='.50' stroke-width='2' opacity='.95'/%3E%3Cpath d='M20 40 L30 32 L34 36 L46 26' fill='none' stroke='url(%23arrowG)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M46 26 h8 v8' fill='none' stroke='url(%23arrowG)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cline x1='20' y1='28' x2='44' y2='28' stroke='%23FFFFFF' stroke-opacity='.55' stroke-width='2'/%3E%3Cline x1='20' y1='34' x2='34' y2='34' stroke='%23FFFFFF' stroke-opacity='.45' stroke-width='2'/%3E%3C/svg%3E")
            center/38px 38px no-repeat,
          radial-gradient(
            100% 100% at 30% 30%,
            rgba(255, 255, 255, 0.18),
            rgba(255, 255, 255, 0) 60%
          ),
          linear-gradient(135deg, #10b981, #059669);
        box-shadow: 0 8px 24px rgba(4, 120, 87, 0.35),
          /* 下方投影 */ 0 0 0 8px rgba(16, 185, 129, 0.2),
          /* 外环 1 */ 0 0 0 16px rgba(16, 185, 129, 0.08); /* 外环 2 */
      }
      .hero-badge::after {
        content: "";
        position: absolute;
        inset: -14px;
        border-radius: 50%;
        background: radial-gradient(
          60% 60% at 50% 50%,
          rgba(16, 185, 129, 0.25),
          rgba(16, 185, 129, 0) 70%
        );
        pointer-events: none;
      }

      .hero-title {
        font-size: 22px;
        font-weight: 700;
        margin: 0 0 6px;
      }
      .hero-sub {
        font-size: 13px;
        color: var(--neutral-600);
        margin: 0;
      }

      .hero-actions {
        margin-top: 14px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* 按钮 */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
        border: none;
        outline: none;
        border-radius: 999px;
        padding: 12px 16px; /* 提高触控面积 */
        min-height: 44px;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.12s ease-out;
      }

      .btn-primary {
        color: #fff;
        background: var(--primary-500);
        box-shadow: 0 8px 18px rgba(16, 185, 129, 0.22);
      }
      .btn-primary:hover {
        background: var(--primary-600);
        transform: translateY(-1px);
      }
      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(4, 120, 87, 0.28);
      }

      .btn-secondary {
        color: var(--primary-700);
        background: #fff;
        border: 1px solid var(--primary-200);
      }
      .btn-secondary:hover {
        background: var(--primary-50);
      }

      /* 栅格 */
      .grid {
        display: grid;
        gap: 12px;
        grid-template-columns: 1fr; /* 单列 */
        margin-top: 12px;
      }
      /* 所有列在移动端占满整宽 */
      .col-8,
      .col-4,
      .col-6,
      .col-12 {
        grid-column: 1 / -1;
      }

      /* 卡片 */
      .card {
        border-radius: 16px;
        background: #fff;
        border: 1px solid var(--neutral-100);
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: 0 8px 24px rgba(12, 32, 61, 0.04);
      }
      /* 品牌化：身份/关系专用卡（更有辨识度） */
      .card-identity {
        position: relative;
        /* 渐变描边（明显可见） */
        border-radius: 16px;
        border: 2px solid transparent;
        /* 柔和的浅底，避免纯白过于普通 */
        --id-bg: linear-gradient(180deg, var(--primary-50), #ffffff 70%);
        background: var(--id-bg) padding-box,
          linear-gradient(135deg, var(--primary-400), var(--primary-600))
            border-box;
        box-shadow: 0 10px 36px rgba(16, 185, 129, 0.18);
        overflow: hidden;
      }
      .card-identity::before {
        /* 顶部色带（更显眼） */
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        height: 44px;
        background: linear-gradient(
          135deg,
          var(--primary-400),
          var(--primary-600)
        );
        opacity: 0.92;
      }
      .card-identity::after {
        /* 右上角柔光圆点 */
        content: "";
        position: absolute;
        right: -18px;
        top: -18px;
        width: 84px;
        height: 84px;
        border-radius: 50%;
        background: radial-gradient(
            closest-side,
            rgba(255, 255, 255, 0.8),
            rgba(255, 255, 255, 0) 70%
          ),
          linear-gradient(135deg, var(--primary-400), var(--primary-600));
        opacity: 0.28;
        filter: blur(0.2px);
      }
      .card-identity {
        padding-top: 58px;
      }
      .card-identity .card-title {
        font-weight: 800;
        letter-spacing: 0.2px;
      }
      .card-identity .chip {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.2);
        color: var(--primary-700);
      }

      .card-title {
        font-size: 15px;
        font-weight: 600;
      }
      .meta {
        font-size: 12px;
        color: var(--neutral-600);
      }
      .muted {
        color: var(--neutral-400);
      }

      .row {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .space-between {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      /* 标签/状态 */
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 11px;
        border: 1px solid var(--neutral-100);
        background: #fff;
        color: var(--neutral-600);
      }
      .pill-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--primary-500);
      }
      .chip {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: var(--primary-50);
        color: var(--primary-700);
        border: 1px solid var(--primary-100);
      }

      /* 信息条/进度 */
      .progress {
        position: relative;
        width: 100%;
        height: 10px;
        background: var(--neutral-100);
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e8eef3;
      }
      .progress > i {
        position: absolute;
        inset: 0 0 0 0;
        display: block;
      }
      .progress .bar {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-400),
          var(--primary-600)
        );
      }

      /* 输入组 */
      .input-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .input-label {
        font-size: 12px;
        color: var(--neutral-600);
      }
      .input-field {
        border-radius: 12px;
        border: 1px solid var(--neutral-200);
        background: #fff;
        font-size: 14px;
        padding: 10px 12px;
        outline: none;
        color: var(--neutral-900);
      }
      .input-field:focus {
        border-color: var(--primary-300);
        box-shadow: 0 0 0 2px var(--primary-50);
        background: var(--primary-50);
      }
      .support {
        font-size: 12px;
        color: var(--neutral-400);
      }

      /* 分割标题 */
      .section-title {
        font-size: 16px;
        font-weight: 700;
        margin: 4px 0 2px;
      }
      .subsection-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--neutral-600);
        margin: 4px 0 6px;
      }

      /* 列表 */
      .list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .list-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px;
        border-radius: 12px;
        border: 1px solid var(--neutral-100);
        background: #fff;
      }
      .list-title {
        font-size: 14px;
        font-weight: 600;
      }
      .list-meta {
        font-size: 12px;
        color: var(--neutral-600);
      }

      /* 模态层 */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(2, 10, 18, 0.35);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 16px;
        z-index: 1000;
      }
      .modal {
        width: min(560px, 100%);
        background: #fff;
        border-radius: 16px;
        border: 1px solid var(--neutral-100);
        box-shadow: 0 12px 36px rgba(2, 10, 18, 0.25);
        overflow: hidden;
      }
      .modal-header {
        padding: 12px 14px;
        border-bottom: 1px solid var(--neutral-100);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .modal-title {
        font-size: 16px;
        font-weight: 700;
      }
      .modal-body {
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .modal-footer {
        padding: 12px 14px;
        border-top: 1px solid var(--neutral-100);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
      }
      .close-btn {
        background: transparent;
        color: var(--neutral-600);
        border: none;
        font-size: 20px;
        cursor: pointer;
        line-height: 1;
      }

      /* 热力值块 */
      .heat-box {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .heat-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .heat-value {
        font-size: 22px;
        font-weight: 800;
        color: var(--primary-700);
      }
      .heat-tag {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        background: var(--primary-50);
        color: var(--primary-700);
        border: 1px solid var(--primary-100);
      }
      .spark {
        height: 36px;
        width: 100%;
        border-radius: 10px;
        background: linear-gradient(90deg, #e5f9f2, #e9faee);
        position: relative;
        overflow: hidden;
        border: 1px solid var(--neutral-100);
      }
      .spark-bar {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 60%;
        background: linear-gradient(
          90deg,
          var(--primary-300),
          var(--primary-600)
        );
        opacity: 0.25;
      }
      .spark-dot {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--primary-600);
        box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.15);
      }

      /* 顶部Tips */
      .tips {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      /* 身份概览 */
      .overview-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .overview-item {
        flex: 1 1 160px;
        border: 1px solid var(--neutral-100);
        border-radius: 12px;
        background: #fff;
        padding: 10px;
      }
      .kv-label {
        font-size: 12px;
        color: var(--neutral-600);
      }
      .kv-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--neutral-900);
        line-height: 1.3;
      }
      .kv-green {
        color: var(--primary-700);
      }
      .overview-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .overview-line {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 2px 0;
      }
      .line-left {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .line-right {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .star-chip {
        background: var(--primary-50);
        color: var(--primary-700);
        border: 1px solid var(--primary-100);
        border-radius: 999px;
        padding: 4px 10px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
      }

      /* 通用图标 */
      .icon {
        width: 14px;
        height: 14px;
        display: inline-block;
        vertical-align: -2px;
      }
      .icon-lg {
        width: 18px;
        height: 18px;
        vertical-align: -2px;
      }
      .icon-star {
        fill: var(--primary-600);
      }

      /* 信息按钮与吐司 */
      .info-btn {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 1px solid var(--neutral-200);
        background: #fff;
        color: var(--neutral-600);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        cursor: pointer;
      }
      .toast {
        position: fixed;
        left: 50%;
        bottom: calc(20px + env(safe-area-inset-bottom));
        transform: translateX(-50%);
        background: rgba(30, 37, 45, 0.92);
        color: #fff;
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 12px;
        max-width: 90%;
        line-height: 1.4;
        box-shadow: 0 8px 24px rgba(2, 10, 18, 0.24);
        display: none;
        z-index: 2000;
      }
      .toast.show {
        display: block;
      }

      /* 隐藏/显示 */
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <section class="hero hero-grid">
        <div class="row">
          <div class="pill">
            <span class="pill-dot"></span> 新东家身份 · 首页
          </div>
        </div>
        <h1 class="hero-title">共赢从此开始</h1>
        <p class="hero-sub">
          完成 团队长 — 担保人
          绑定后，可申请代打赏或直接代打赏团队长，额度与热力值一目了然。
        </p>
        <div class="hero-metrics">
          <div class="hero-metric">
            <div class="metric-label">我的星级</div>
            <div class="metric-value">
              <span class="star-chip" id="heroStar">
                <svg
                  class="icon icon-star"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                  />
                </svg>
                <span id="heroStarText">3星</span>
              </span>
            </div>
          </div>
          <div class="hero-metric">
            <div class="metric-label">热力值</div>
            <div class="metric-value">
              <span class="metric-number" id="heroHeatValue">128</span>
            </div>
          </div>
        </div>
      </section>

      <div class="grid">
        <!-- 1) 身份概览（星级 + 热力值） 已整合进 Hero，以下卡片默认隐藏 -->
        <div class="col-12 hidden">
          <div class="card card-identity">
            <div class="card-title" style="margin-bottom: 6px">身份概览</div>
            <div class="overview-list">
              <div class="overview-line">
                <div class="line-left">
                  <span class="kv-label">我的星级</span>
                  <button
                    class="info-btn"
                    id="starInfoBtn"
                    aria-label="星级规则"
                  >
                    i
                  </button>
                </div>
                <div class="line-right">
                  <span class="star-chip" id="starNow">
                    <svg
                      class="icon icon-star"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                      />
                    </svg>
                    <span id="starNowText">3星</span>
                  </span>
                </div>
              </div>
              <div class="overview-line">
                <div class="line-left">
                  <span class="kv-label">热力值</span>
                  <button
                    class="info-btn"
                    id="heatInfoBtn"
                    aria-label="热力值说明"
                  >
                    i
                  </button>
                </div>
                <div class="line-right">
                  <span class="kv-value kv-green" id="heatValue">128</span>
                </div>
              </div>
              <div class="meta" id="heatUpdatedAt">更新时间：—</div>
            </div>
          </div>
        </div>

        <!-- 2) 我的额度 -->
        <div class="col-12">
          <div class="card">
            <div class="space-between">
              <div class="card-title">我的额度</div>
              <div class="row">
                <button
                  class="info-btn"
                  id="quotaInfoBtn"
                  aria-label="额度说明"
                >
                  i
                </button>
                <div class="meta">单位：CNV</div>
              </div>
            </div>
            <div class="space-between">
              <div class="list-title">
                <span id="remainQuota">10,000</span> /
                <span id="totalQuota">12,000</span>
              </div>
              <span class="chip">已使用 <span id="usedPct">16.7%</span></span>
            </div>
            <div class="progress" aria-label="额度进度">
              <i class="bar" id="quotaBar" style="width: 83.3%"></i>
            </div>
            <div class="meta">提示：直接代打赏金额需小于等于剩余额度。</div>
          </div>
        </div>

        <!-- 3) 热力值 已合并入身份概览 -->

        <!-- 4) 我的团队关系 -->
        <!-- 左侧主信息 -->
        <div class="col-8" id="leftCol">
          <!-- 我的团队关系 -->
          <div class="card">
            <div class="space-between">
              <div class="card-title">我的团队关系</div>
              <div class="row">
                <span class="pill" id="bindStateTag"
                  ><span class="pill-dot"></span> 已绑定</span
                >
                <span class="pill" id="myStarPill">
                  <svg
                    class="icon icon-star"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                    />
                  </svg>
                  <span id="myStarText">3星</span>
                </span>
              </div>
            </div>

            <!-- 多团队长展示（动态渲染） -->
            <div id="leadersContainer">
              <div class="meta" id="leadersSummary">已绑定团队长 0 位</div>
              <div class="list" id="leadersList"></div>
            </div>

            <!-- 未绑定提示块 -->
            <div id="bindPanel" class="hidden">
              <div class="section-title">绑定团队长</div>
              <div class="grid">
                <div class="col-8">
                  <div class="input-group">
                    <label class="input-label">团队长邀请码</label>
                    <input
                      class="input-field"
                      id="inviteCode"
                      placeholder="请输入团队长的邀请码"
                    />
                    <div class="support">
                      说明：绑定后即可成为该团队长的新东家身份，进入后续代打赏流程。
                    </div>
                  </div>
                </div>
                <div class="col-4" style="display: flex; align-items: flex-end">
                  <button
                    class="btn btn-primary"
                    id="bindBtn"
                    style="width: 100%"
                  >
                    绑定团队长
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 5) 本次你可以做什么（CTA） -->
          <div class="card">
            <div class="card-title">本次你可以做什么</div>
            <div class="row" style="flex-direction: column; gap: 10px">
              <button
                class="btn btn-primary"
                id="openApply"
                style="width: 100%"
              >
                申请团队长代打赏
              </button>
              <button
                class="btn btn-secondary"
                id="openDirect"
                style="width: 100%"
              >
                代打赏团队长
              </button>
              <button
                class="btn btn-secondary"
                id="viewRecords"
                style="width: 100%"
              >
                查看代打赏记录
              </button>
            </div>
          </div>

          <!-- 6) 引导提示 -->
          <div
            class="card"
            style="background: var(--neutral-50); border-style: dashed"
          >
            <div class="meta">
              首次参与 BV 共赢计划
              时，建议先完成「申请团队长代打赏」，再进行「代打赏团队长」，以避免额度不足或流程不完整。
            </div>
          </div>

          <!-- 历史记录 -->
          <div class="card" id="historySection">
            <div class="space-between">
              <div class="card-title">我的历史记录</div>
              <div class="row">
                <span class="pill" id="recentCountPill"
                  ><span class="pill-dot"></span> 最近 · 0 条</span
                >
              </div>
            </div>
            <div class="list" id="historyList"></div>
            <div class="row" style="justify-content: flex-end; margin-top: 8px">
              <button class="btn btn-secondary" id="openFullRecords">
                查看完整记录
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 模态：申请团队长代打赏 -->
      <div class="modal-backdrop" id="applyModal">
        <div
          class="modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="applyTitle"
        >
          <div class="modal-header">
            <div class="modal-title" id="applyTitle">申请团队长代打赏</div>
            <button class="close-btn" data-close="applyModal" aria-label="关闭">
              ×
            </button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label class="input-label">本次申请 CNV 数量</label>
              <input
                class="input-field"
                id="applyCnv"
                type="number"
                min="0"
                step="1"
                placeholder="例如 10000"
              />
              <div class="support">
                说明：需同时支付 1% DOS 作为服务费；提交后 CNV 与 DOS
                将冻结，等待团队长代打赏。
              </div>
            </div>
            <div class="row" style="justify-content: space-between">
              <div class="meta">预计需 DOS：<b id="applyDosNeed">0</b></div>
              <div class="meta">
                我的余额 · CNV <span id="cnvBalMini">15,000</span> · DOS
                <span id="dosBalMini">500</span>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-close="applyModal">
              取消
            </button>
            <button class="btn btn-primary" id="submitApply">提交申请</button>
          </div>
        </div>
      </div>

      <!-- 模态：直接代打赏团队长 -->
      <div class="modal-backdrop" id="directModal">
        <div
          class="modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="directTitle"
        >
          <div class="modal-header">
            <div class="modal-title" id="directTitle">直接代打赏团队长</div>
            <button
              class="close-btn"
              data-close="directModal"
              aria-label="关闭"
            >
              ×
            </button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label class="input-label">BV 数量</label>
              <input
                class="input-field"
                id="directBV"
                type="number"
                min="0"
                step="1"
                placeholder="例如 900"
              />
            </div>
            <div class="input-group">
              <label class="input-label">东家积分</label>
              <input
                class="input-field"
                id="directPoints"
                type="number"
                min="0"
                step="1"
                placeholder="例如 100"
              />
            </div>
            <div class="support">
              需满足：BV+积分对应价值 ≤ 我的剩余可代打赏额度（CNV）。示例：900BV
              + 100积分 ≈ 1000 BV 价值。
            </div>
            <div
              class="row"
              style="justify-content: space-between; margin-top: 6px"
            >
              <div class="meta">
                本次合计价值（估）：<b id="directTotal">0</b> CNV
              </div>
              <div class="meta">
                剩余额度：<b id="remainMini">10,000</b> CNV
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-close="directModal">
              取消
            </button>
            <button class="btn btn-primary" id="submitDirect">
              确认代打赏
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite">
      <span id="toastText">提示</span>
    </div>

    <script>
      // 配置：实际路由与接口（可按环境替换）
      const config = {
        routes: { fullRecords: "/bvwin/records?role=new_employer" },
        api: { recentRecords: "/api/bvwin/records?role=new_employer&limit=2" },
      };

      // 简单的状态/数据模拟
      const state = {
        bound: true, // 是否已绑定团队长
        quota: { total: 12000, remain: 10000 },
        balances: { cnv: 15000, dos: 500 },
        heat: 128,
        heatUpdatedAt: "—",
        star: 3, // 新东家星级（示例）
        // 多团队长绑定（演示数据）
        leaders: [
          {
            id: "TL001",
            account: "dj_tl_8899",
            name: "王**",
            phone: "138****7788",
            verified: true,
            default: true,
            guarantors: [
              {
                account: "dj_dbr_1234",
                name: "李**",
                phone: "139****6622",
                status: "额度充足",
              },
              {
                account: "dj_dbr_5678",
                name: "陈**",
                phone: "137****4422",
                status: "额度一般",
              },
            ],
          },
          {
            id: "TL002",
            account: "dj_tl_6620",
            name: "赵**",
            phone: "136****9988",
            verified: true,
            default: false,
            guarantors: [
              {
                account: "dj_dbr_7788",
                name: "周**",
                phone: "139****3311",
                status: "额度充足",
              },
            ],
          },
          {
            id: "TL003",
            account: "dj_tl_7031",
            name: "孙**",
            phone: "135****1234",
            verified: true,
            default: false,
            guarantors: [
              {
                account: "dj_dbr_9900",
                name: "吴**",
                phone: "138****2244",
                status: "额度偏紧",
              },
              {
                account: "dj_dbr_9911",
                name: "郑**",
                phone: "137****8899",
                status: "额度充足",
              },
            ],
          },
        ],
        // 最近记录（演示数据）。真实环境下由接口返回。
        history: [
          {
            kind: "apply",
            cnv: 10000,
            status: "pending",
            orderId: "PK20251012-XX889",
            time: "2025-10-12 10:20",
          },
          {
            kind: "direct",
            bv: 1000,
            points: 100,
            status: "done",
            orderId: "PK20251013-AB123",
            time: "2025-10-13 15:00",
          },
          {
            kind: "apply",
            cnv: 5000,
            status: "service",
            orderId: "PK20251015-ZZ778",
            time: "2025-10-15 09:12",
          },
        ],
      };

      const fmt = (n) => n.toLocaleString("zh-CN");

      // 初始化界面数字
      function initNumbers() {
        const { total, remain } = state.quota;
        const used = total === 0 ? 0 : (remain / total) * 100; // 实际这里显示的是“剩余/总额度”，用于进度条填充
        document.getElementById("remainQuota").textContent = fmt(remain);
        document.getElementById("totalQuota").textContent = fmt(total);
        document.getElementById("usedPct").textContent =
          (100 - used).toFixed(1) + "%";
        document.getElementById("quotaBar").style.width =
          Math.max(0, Math.min(100, (remain / total) * 100)) + "%";

        const cnvBalEl = document.getElementById("cnvBalance");
        if (cnvBalEl) cnvBalEl.textContent = fmt(state.balances.cnv);
        const dosBalEl = document.getElementById("dosBalance");
        if (dosBalEl) dosBalEl.textContent = fmt(state.balances.dos);
        document.getElementById("cnvBalMini").textContent = fmt(
          state.balances.cnv
        );
        document.getElementById("dosBalMini").textContent = fmt(
          state.balances.dos
        );
        document.getElementById("remainMini").textContent = fmt(remain);

        const hv = Math.max(0, Number(state.heat) || 0);
        const hvEl = document.getElementById("heatValue");
        if (hvEl) hvEl.textContent = Intl.NumberFormat("zh-CN").format(hv);
        const hvHeroEl = document.getElementById("heroHeatValue");
        if (hvHeroEl)
          hvHeroEl.textContent = Intl.NumberFormat("zh-CN").format(hv);
        const hut = document.getElementById("heatUpdatedAt");
        if (hut) hut.textContent = `更新时间：${state.heatUpdatedAt}`;

        if (!state.bound) {
          document.getElementById("bindPanel").classList.remove("hidden");
          document.getElementById("bindStateTag").innerHTML =
            '<span class="pill-dot" style="background:#94A3B8"></span> 未绑定';
        }

        // 星级显示（使用 SVG 图标 + 文本）
        const starPillText = document.getElementById("myStarText");
        if (starPillText) starPillText.textContent = `${state.star}星`;
        const starNowText = document.getElementById("starNowText");
        if (starNowText) starNowText.textContent = `${state.star}星`;
        const heroStarText = document.getElementById("heroStarText");
        if (heroStarText) heroStarText.textContent = `${state.star}星`;
      }

      // 渲染“我的团队关系”：多团队长 + 担保人详情
      function renderLeaders() {
        const listEl = document.getElementById("leadersList");
        const summaryEl = document.getElementById("leadersSummary");
        const bindStateTag = document.getElementById("bindStateTag");
        if (!listEl) return;
        listEl.innerHTML = "";

        const leaders = Array.isArray(state.leaders) ? state.leaders : [];
        const count = leaders.length;

        if (summaryEl)
          summaryEl.textContent = count
            ? `已绑定团队长 ${count} 位`
            : "未绑定团队长";
        if (bindStateTag) {
          bindStateTag.innerHTML = count
            ? '<span class="pill-dot"></span> 已绑定 · ' + count + " 位"
            : '<span class="pill-dot" style="background:#94A3B8"></span> 未绑定';
        }

        const bindPanel = document.getElementById("bindPanel");
        if (bindPanel)
          count
            ? bindPanel.classList.add("hidden")
            : bindPanel.classList.remove("hidden");

        if (!count) return;

        leaders.forEach((ld, i) => {
          const wrap = document.createElement("div");
          wrap.className = "list-item";
          const defaultChip = ld.default
            ? '<span class="chip">默认</span>'
            : "";
          const verifyChip = ld.verified
            ? '<span class="chip">已认证团队长</span>'
            : '<span class="chip" style="background:#FEF3C7;color:#92400E;border-color:#FDE68A;">待审核</span>';
          const gCount = Array.isArray(ld.guarantors)
            ? ld.guarantors.length
            : 0;
          wrap.innerHTML = `
          <div>
            <div class="list-title">团队长：${ld.account} · ${ld.name} · ${
            ld.phone
          }</div>
            <div class="list-meta">${verifyChip} ${defaultChip} · 担保人 ${gCount} 名</div>
          </div>
          <div class="row">
            <button class="btn btn-secondary" data-action="toggle" data-index="${i}" style="padding:6px 10px">详情</button>
            ${
              ld.default
                ? ""
                : `<button class="btn btn-secondary" data-action="setDefault" data-index="${i}" style="padding:6px 10px">设为默认</button>`
            }
          </div>
        `;
          listEl.appendChild(wrap);

          const det = document.createElement("div");
          det.id = `leader-details-${i}`;
          det.className = "list";
          det.style.display = "none";
          det.style.marginTop = "8px";
          (ld.guarantors || []).forEach((g) => {
            const gi = document.createElement("div");
            gi.className = "list-item";
            gi.innerHTML = `
            <div>
              <div class="list-title">担保人：${g.account} · ${g.name} · ${
              g.phone
            }</div>
              <div class="list-meta">状态：<span class="chip">${
                g.status || "—"
              }</span></div>
            </div>
          `;
            det.appendChild(gi);
          });
          listEl.appendChild(det);
        });

        // 事件委托（防重复绑定，使用 onclick 赋值）
        listEl.onclick = (e) => {
          const btn = e.target.closest("button[data-action]");
          if (!btn) return;
          const idx = Number(btn.getAttribute("data-index") || "-1");
          const act = btn.getAttribute("data-action");
          if (act === "toggle") {
            const el = document.getElementById(`leader-details-${idx}`);
            if (el)
              el.style.display = el.style.display === "none" ? "block" : "none";
          } else if (act === "setDefault") {
            (state.leaders || []).forEach((L, j) => {
              L.default = j === idx;
            });
            renderLeaders();
            showToast("已设为默认团队长");
          }
        };
      }

      // 渲染首页最近两条记录 + 完整记录入口
      function renderHistory(limit = 2, opts = {}) {
        const list = document.getElementById("historyList");
        const pill = document.getElementById("recentCountPill");
        if (!list) return;
        list.innerHTML = "";

        const items = Array.isArray(state.history)
          ? state.history.slice(0, limit)
          : [];
        if (pill)
          pill.innerHTML = `<span class="pill-dot"></span> 最近 · ${items.length} 条`;

        if (!items.length) {
          const empty = document.createElement("div");
          empty.className = "meta";
          empty.textContent = "暂无代打赏记录";
          list.appendChild(empty);
          return;
        }

        const statusChip = (status) => {
          if (status === "done")
            return '<span class="chip" style="background:#F0F9FF;color:#0C4A6E;border-color:#E0F2FE;">已完成</span>';
          if (status === "service")
            return '<span class="chip" style="background:#FEF3C7;color:#92400E;border-color:#FDE68A;">客服介入中</span>';
          return '<span class="chip">待团队长确认</span>';
        };

        items.forEach((it) => {
          const wrap = document.createElement("div");
          wrap.className = "list-item";
          const title =
            it.kind === "apply"
              ? `申请代打赏 · ${fmt(it.cnv)} CNV`
              : `直接代打赏团队长 · ${fmt(it.bv || 0)} BV + ${fmt(
                  it.points || 0
                )} 积分`;
          wrap.innerHTML = `
          <div>
            <div class="list-title">${title}</div>
            <div class="list-meta">时间 ${it.time}</div>
          </div>
          <div class="row">${statusChip(it.status)}</div>
        `;
          list.appendChild(wrap);
        });

        // 控制“查看完整记录”按钮显示
        const fullBtn = document.getElementById("openFullRecords");
        const hasMore =
          !!opts.hasMore ||
          (Array.isArray(state.history) && state.history.length > limit);
        if (fullBtn) fullBtn.style.display = hasMore ? "inline-flex" : "none";
      }

      // 拉取最近记录（含降级兜底）
      async function loadRecentHistory() {
        const list = document.getElementById("historyList");
        if (list) list.innerHTML = '<div class="meta">加载中…</div>';
        try {
          const res = await fetch(config.api.recentRecords, {
            credentials: "include",
          });
          if (!res.ok) throw new Error("http");
          const data = await res.json();
          const items = Array.isArray(data.items) ? data.items : [];
          const norm = (r) => ({
            kind:
              (r.kind || r.type || (r.bv || r.points ? "direct" : "apply")) ===
              "apply"
                ? "apply"
                : "direct",
            cnv: r.cnv ?? r.amount ?? r.cnvAmount ?? 0,
            bv: r.bv ?? 0,
            points: r.points ?? r.djPoints ?? 0,
            status: r.status ?? r.state ?? "pending",
            orderId: r.orderId ?? r.order_no ?? r.id ?? "",
            time: r.time ?? r.createdAt ?? r.created_at ?? "",
          });
          state.history = items.map(norm);
          renderHistory(2, { hasMore: !!data.hasMore || data.total > 2 });
        } catch (e) {
          renderHistory(2);
        }
      }

      // 模态显示/关闭
      function openModal(id) {
        document.getElementById(id).style.display = "flex";
      }
      function closeModal(id) {
        document.getElementById(id).style.display = "none";
      }

      document
        .getElementById("openApply")
        .addEventListener("click", () => openModal("applyModal"));
      document
        .getElementById("openDirect")
        .addEventListener("click", () => openModal("directModal"));

      document.querySelectorAll("[data-close]").forEach((btn) => {
        btn.addEventListener("click", (e) =>
          closeModal(e.currentTarget.getAttribute("data-close"))
        );
      });

      // 申请代打赏：计算 DOS
      const applyCnv = document.getElementById("applyCnv");
      const applyDosNeed = document.getElementById("applyDosNeed");
      applyCnv.addEventListener("input", () => {
        const v = Math.max(0, Number(applyCnv.value || 0));
        const need = v * 0.01; // 1% DOS
        applyDosNeed.textContent = Intl.NumberFormat("zh-CN", {
          maximumFractionDigits: 2,
        }).format(need);
      });

      document.getElementById("submitApply").addEventListener("click", () => {
        const v = Math.max(0, Number(applyCnv.value || 0));
        const need = v * 0.01;
        if (!v) {
          alert("请输入申请的 CNV 数量");
          return;
        }
        if (v > state.balances.cnv) {
          alert("CNV 余额不足");
          return;
        }
        if (need > state.balances.dos) {
          alert("DOS 余额不足（需 1% DOS）");
          return;
        }
        // 仅演示：真正提交应调用后端接口
        alert("已提交申请，等待团队长代打赏");
        closeModal("applyModal");
      });

      // 直接代打赏：估算价值（演示按 BV+积分 = CNV 1:1）
      const directBV = document.getElementById("directBV");
      const directPoints = document.getElementById("directPoints");
      const directTotal = document.getElementById("directTotal");
      function refreshDirectTotal() {
        const bv = Math.max(0, Number(directBV.value || 0));
        const pt = Math.max(0, Number(directPoints.value || 0));
        const total = bv + pt; // 仅 UI 演示，不代表真实汇率
        directTotal.textContent = fmt(total);
        return total;
      }
      directBV.addEventListener("input", refreshDirectTotal);
      directPoints.addEventListener("input", refreshDirectTotal);

      document.getElementById("submitDirect").addEventListener("click", () => {
        const total = refreshDirectTotal();
        if (total <= 0) {
          alert("请输入 BV 与 积分");
          return;
        }
        if (total > state.quota.remain) {
          alert("超出剩余额度，无法提交");
          return;
        }
        alert("已创建代打赏订单，如团队长码库CNV充足将自动完成");
        closeModal("directModal");
      });

      // 查看记录：滚动到历史记录区
      const viewBtn = document.getElementById("viewRecords");
      if (viewBtn) {
        viewBtn.addEventListener("click", () => {
          const el = document.getElementById("historySection");
          if (el && el.scrollIntoView)
            el.scrollIntoView({ behavior: "smooth", block: "start" });
        });
      }

      // 查看完整记录
      const fullBtn = document.getElementById("openFullRecords");
      if (fullBtn) {
        fullBtn.addEventListener("click", () => {
          window.location.href = config.routes.fullRecords;
        });
      }

      // 简易 Toast
      let toastTimer = null;
      function showToast(msg, ms = 2400) {
        const el = document.getElementById("toast");
        const text = document.getElementById("toastText");
        if (!el || !text) return;
        text.textContent = msg;
        el.classList.add("show");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => el.classList.remove("show"), ms);
      }

      // 星级规则提示（i 图标）
      const starInfoBtn = document.getElementById("starInfoBtn");
      if (starInfoBtn) {
        starInfoBtn.addEventListener("click", () => {
          showToast(
            "星级用于功能资格判断（如申请担保人/团队长等），规则由平台评估与下发。"
          );
        });
      }

      // 热力值说明（i 图标）
      const heatInfoBtn = document.getElementById("heatInfoBtn");
      if (heatInfoBtn) {
        heatInfoBtn.addEventListener("click", () => {
          showToast(
            "热力值来源于服务端计算，推荐人数越多数值越高，显示不设上限。"
          );
        });
      }

      // 额度说明（i 图标）
      const quotaInfoBtn = document.getElementById("quotaInfoBtn");
      if (quotaInfoBtn) {
        quotaInfoBtn.addEventListener("click", () => {
          showToast("剩余可代打赏团队长额度");
        });
      }

      // 绑定团队长（演示）
      const bindBtn = document.getElementById("bindBtn");
      if (bindBtn) {
        bindBtn.addEventListener("click", () => {
          const code = (
            document.getElementById("inviteCode").value || ""
          ).trim();
          if (!code) {
            alert("请输入团队长邀请码");
            return;
          }
          alert("已提交绑定申请：" + code + "，等待审核");
        });
      }

      // 初始化
      initNumbers();
      renderLeaders();
      renderHistory(2);
      loadRecentHistory();
    </script>
  </body>
</html>
